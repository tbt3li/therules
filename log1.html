<!DOCTYPE html>
<html>
<head>
    <title>Family Login</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 400px; 
            margin: 50px auto; 
            padding: 20px; 
        }
        input, button { 
            width: 100%; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border: 1px solid #ddd; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        button:hover { background: #0056b3; }
        .tab { 
            cursor: pointer; 
            padding: 10px; 
            display: inline-block; 
        }
        .active { 
            border-bottom: 3px solid #007bff; 
            font-weight: bold; 
        }
        .message { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            display: none; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Family Portal</h1>
    
    <!-- Tabs -->
    <div>
        <span class="tab active" onclick="showTab('login')">Login</span>
        <span class="tab" onclick="showTab('signup')">Signup</span>
    </div>

    <!-- Messages -->
    <div id="message" class="message"></div>

    <!-- Login Form -->
    <div id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPassword" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>

    <!-- Signup Form -->
    <div id="signupForm" style="display:none;">
        <input type="text" id="signupName" placeholder="Full Name">
        <input type="email" id="signupEmail" placeholder="Email">
        <input type="password" id="signupPassword" placeholder="Password">
        <button onclick="signup()">Sign Up</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display:none;">
        <h2>Welcome, <span id="userName"></span>!</h2>
        <p>Email: <span id="userEmail"></span></p>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        const API_URL = 'https://login.t3li.workers.dev';
        let authToken = localStorage.getItem('token');

        // Check login on page load
        if (authToken) {
            checkLogin();
        }

        // Show/hide tabs
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('loginForm').style.display = tab === 'login' ? 'block' : 'none';
            document.getElementById('signupForm').style.display = tab === 'signup' ? 'block' : 'none';
        }

        // Show message
        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        // Signup
        async function signup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !password) {
                showMessage('All fields required', 'error');
                return;
            }

            const response = await fetch(`${API_URL}/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, password })
            });

            const data = await response.json();

            if (data.success) {
                authToken = data.token;
                localStorage.setItem('token', authToken);
                showDashboard(data.user);
                showMessage('Account created!', 'success');
            } else {
                showMessage(data.error, 'error');
            }
        }

        // Login
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const response = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (data.success) {
                authToken = data.token;
                localStorage.setItem('token', authToken);
                showDashboard(data.user);
                showMessage('Logged in!', 'success');
            } else {
                showMessage(data.error, 'error');
            }
        }

        // Check login status
        async function checkLogin() {
            const response = await fetch(`${API_URL}/check`, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });

            const data = await response.json();

            if (data.success) {
                showDashboard(data.user);
            } else {
                localStorage.removeItem('token');
                authToken = null;
            }
        }

        // Show dashboard
        function showDashboard(user) {
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userEmail').textContent = user.email;
            
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.querySelector('.tab').style.display = 'none';
        }

        // Logout
        async function logout() {
            if (authToken) {
                await fetch(`${API_URL}/logout`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
            }
            
            localStorage.removeItem('token');
            authToken = null;
            
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.querySelector('.tab').style.display = 'inline-block';
            
            showTab('login');
        }

        // Enter key support
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('loginForm').style.display !== 'none') {
                    login();
                } else if (document.getElementById('signupForm').style.display !== 'none') {
                    signup();
                }
            }
        });
    </script>
</body>
</html>
